# JSON Schema for channel specification YAML files
# Validates the structure of channels.yaml

$schema: "http://json-schema.org/draft-07/schema#"
title: Channel property mapping schema
description: Schema for defining channel categories and their required/optional properties

definitions:
  # Data type enumeration
  dataTypeEnum:
    type: string
    enum:
      - char
      - uchar
      - short
      - ushort
      - int
      - uint
      - float
      - bool
      - string
      - enum
      - unknown

  # Unit type (string or null)
  unitType:
    oneOf:
      - type: "null"
      - type: string
    default: null

  # Format type (null, string array for enum, or number range)
  formatType:
    oneOf:
      - type: "null"
      - type: array
        uniqueItems: true
        items:
          type: string
      - type: array
        uniqueItems: true
        items:
          oneOf:
            - type: "null"
            - type: number
        minItems: 2
        maxItems: 2

  # Invalid value type
  invalidType:
    oneOf:
      - type: "null"
      - type: string
      - type: number
    default: null

  # Step type
  stepType:
    oneOf:
      - type: "null"
      - type: number
    default: null

  # Description type with language support
  descriptionType:
    type: object
    properties:
      en:
        type: string
    required:
      - en
    additionalProperties: false

  # Data type variant for multi-datatype properties
  dataTypeVariant:
    type: object
    description: A data type variant definition for multi-datatype properties
    required:
      - id
      - data_type
    properties:
      id:
        type: string
        description: Unique identifier for this data type variant
      data_type:
        $ref: "#/definitions/dataTypeEnum"
      unit:
        $ref: "#/definitions/unitType"
      format:
        $ref: "#/definitions/formatType"
      invalid:
        $ref: "#/definitions/invalidType"
      step:
        $ref: "#/definitions/stepType"
      description:
        $ref: "#/definitions/descriptionType"
    additionalProperties: false

  # Property category enumeration
  propertyCategoryEnum:
    type: string
    enum:
      - generic
      - active
      - album
      - angle
      - artist
      - artwork_url
      - aqi
      - balance
      - bass
      - brightness
      - change_needed
      - child_lock
      - color_blue
      - color_green
      - color_red
      - color_temperature
      - color_white
      - command
      - connection_type
      - consumption
      - concentration
      - current
      - defrost_active
      - detected
      - direction
      - distance
      - duration
      - event
      - fault
      - firmware_revision
      - frequency
      - hardware_revision
      - hue
      - humidity
      - illuminance
      - in_use
      - infrared
      - level
      - life_remaining
      - link_quality
      - locked
      - manufacturer
      - media_type
      - mist_level
      - model
      - mode
      - mute
      - natural_breeze
      - obstruction
      - "on"
      - over_current
      - over_voltage
      - over_power
      - pan
      - peak_level
      - percentage
      - position
      - power
      - pressure
      - rate
      - remaining
      - repeat
      - reset
      - remote_key
      - siren
      - saturation
      - serial_number
      - shuffle
      - source
      - source_label
      - state
      - speed
      - status
      - swing
      - tampered
      - temperature
      - triggered
      - tilt
      - timer
      - title
      - treble
      - track
      - type
      - voltage
      - volume
      - warm_mist
      - water_tank_empty
      - water_tank_full
      - water_tank_level
      - zoom

  # Permissions type
  permissionsType:
    type: array
    items:
      type: string
      enum:
        - ro   # Read-only
        - rw   # Read-write
        - wo   # Write-only
        - ev   # Event (push notifications)

  # Single data type property definition
  singleDataTypeProperty:
    type: object
    description: Property with a single data type definition
    required:
      - category
      - required
    properties:
      category:
        $ref: "#/definitions/propertyCategoryEnum"
      required:
        type: boolean
      description:
        $ref: "#/definitions/descriptionType"
      permissions:
        $ref: "#/definitions/permissionsType"
      data_type:
        $ref: "#/definitions/dataTypeEnum"
      unit:
        $ref: "#/definitions/unitType"
      format:
        $ref: "#/definitions/formatType"
      invalid:
        $ref: "#/definitions/invalidType"
      step:
        $ref: "#/definitions/stepType"
    additionalProperties: false

  # Multi data type property definition
  multiDataTypeProperty:
    type: object
    description: Property with multiple data type variants for integrator selection
    required:
      - category
      - required
      - data_types
    properties:
      category:
        $ref: "#/definitions/propertyCategoryEnum"
      required:
        type: boolean
      description:
        $ref: "#/definitions/descriptionType"
      permissions:
        $ref: "#/definitions/permissionsType"
      data_types:
        type: array
        description: Array of data type variants the integrator can choose from
        items:
          $ref: "#/definitions/dataTypeVariant"
        minItems: 1
    additionalProperties: false

type: object

patternProperties:
  "^[a-zA-Z0-9_]+$":
    type: object
    required:
      - category
      - properties
    properties:
      category:
        description: Unique identifier for the channel category
        type: string
        enum:
          - generic
          - air_particulate
          - air_quality
          - alarm
          - battery
          - camera
          - carbon_dioxide
          - carbon_monoxide
          - contact
          - cooler
          - dehumidifier
          - device_information
          - door
          - doorbell
          - electrical_energy
          - electrical_power
          - fan
          - filter
          - flow
          - gas
          - heater
          - humidifier
          - humidity
          - illuminance
          - leak
          - light
          - lock
          - media_input
          - media_playback
          - microphone
          - motion
          - nitrogen_dioxide
          - occupancy
          - outlet
          - ozone
          - pressure
          - robot_vacuum
          - smoke
          - speaker
          - sulphur_dioxide
          - switcher
          - television
          - temperature
          - thermostat
          - valve
          - volatile_organic_compounds
          - window_covering

      name:
        description: Human-readable name for the channel category (used in documentation)
        type: object
        properties:
          en:
            type: string
        required:
          - en
        additionalProperties: false

      description:
        description: Detailed description of the channel category
        $ref: "#/definitions/descriptionType"

      docGroup:
        description: Documentation grouping for organizing channel categories
        type: string
        enum:
          - environmental
          - security
          - control
          - power
          - media
          - misc
          - other

      constraints:
        description: Property constraints defining relationships between properties
        type: object
        properties:
          oneOf:
            description: At most one property from each group can be present (mutually exclusive)
            type: array
            items:
              type: array
              items:
                type: string
              minItems: 2
          oneOrMoreOf:
            description: At least one property from each group must be present
            type: array
            items:
              type: array
              items:
                type: string
              minItems: 2
          mutuallyExclusiveGroups:
            description: Property groups that cannot be mixed (e.g., RGB vs HSV)
            type: array
            items:
              type: array
              items:
                type: array
                items:
                  type: string
                minItems: 1
              minItems: 2
        additionalProperties: false

      properties:
        description: Map of property categories supported by this channel
        type: object
        patternProperties:
          "^[a-zA-Z0-9_]+$":
            oneOf:
              - $ref: "#/definitions/singleDataTypeProperty"
              - $ref: "#/definitions/multiDataTypeProperty"
        additionalProperties: false

    additionalProperties: false

additionalProperties: false
