# IKEA STARKVIND Air Purifier (E2006, E2007, and variants)
# Device-specific mapping for IKEA air purifiers with numeric speed levels
#
# Device has:
# - fan expose with state (fan_state) and mode (fan_mode)
# - mode values: "off", "auto", "1"-"9" (speed levels)
# - fan_speed numeric (1-9)
# - pm25 numeric (air quality)
#
# Spec requires for air_purifier device:
# - fan channel (required) with: on (required), mode (required), speed (optional)
# - air_particulate channel with: density, mode (pm2_5 for PM2.5 sensor)
# - device_information channel (required) - auto-created by adoption service
#
# Known models: E2006 (table), E2007 (floor standing)

version: "1.0"

transformers:
  # Fan state ON/OFF to boolean
  fan_state:
    type: boolean
    true_value: "ON"
    false_value: "OFF"

  # IKEA fan mode to spec mode (passthrough)
  # Device values: "off", "auto", "1"-"9"
  # Spec expects: "auto", "manual", "off", "1"-"10"
  ikea_fan_mode_to_spec:
    type: map
    bidirectional:
      "off": "off"
      "auto": "auto"
      "1": "1"
      "2": "2"
      "3": "3"
      "4": "4"
      "5": "5"
      "6": "6"
      "7": "7"
      "8": "8"
      "9": "9"

  # IKEA fan mode to percentage (for SPEED property)
  # "off" -> 0%, "1" -> 11%, "2" -> 22%, ..., "9" -> 100%
  # "auto" is handled separately (set to 50% as middle value)
  ikea_fan_mode_to_percentage:
    type: map
    bidirectional:
      "off": 0
      "auto": 50
      "1": 11
      "2": 22
      "3": 33
      "4": 44
      "5": 56
      "6": 67
      "7": 78
      "8": 89
      "9": 100

mappings:
  # IKEA STARKVIND Air Purifier - all variants
  # Matches by manufacturer containing "IKEA" (e.g., "IKEA of Sweden") + fan expose + pm25 sensor
  - name: ikea_starkvind
    description: "IKEA STARKVIND air purifier with numeric speed levels"
    priority: 200
    match:
      manufacturer: "IKEA"
      expose_type: fan
      any_property: [pm25]
    device_category: AIR_PURIFIER
    channels:
      # Fan channel (required by air_purifier device spec)
      - identifier: fan
        name: Fan
        category: FAN
        features:
          # On/Off (required by fan channel spec)
          - z2m_feature: state
            panel:
              identifier: ON
              name: Power
              data_type: BOOL
            transformer: fan_state

          # Mode (required by fan channel spec) - maps to enum
          # Spec format: ["auto", "manual", "off", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"]
          - z2m_feature: mode
            panel:
              identifier: MODE
              name: Mode
              data_type: ENUM
              format: ["auto", "off", "1", "2", "3", "4", "5", "6", "7", "8", "9"]
            transformer: ikea_fan_mode_to_spec

          # Speed as percentage (optional) - for UI convenience
          - z2m_feature: mode
            panel:
              identifier: SPEED
              name: Speed
              data_type: UCHAR
              format: [0, 100]
              unit: "%"
            transformer: ikea_fan_mode_to_percentage

  # IKEA STARKVIND PM2.5 Sensor - air particulate channel
  # This mapping handles the pm25 generic expose
  - name: ikea_starkvind_pm25
    description: "IKEA STARKVIND PM2.5 air quality sensor"
    priority: 200
    match:
      manufacturer: "IKEA"
      property: pm25
    device_category: AIR_PURIFIER
    channels:
      # Air particulate channel for PM2.5 readings
      - identifier: air_particulate
        name: Air Quality
        category: AIR_PARTICULATE
        properties:
          # PM2.5 density reading
          - z2m_property: pm25
            panel:
              identifier: DENSITY
              name: PM2.5 Density
              data_type: FLOAT
              format: [0, 1000]
              unit: "µg/m³"
            direction: read_only
        static_properties:
          # Mode indicates the type of particulate (PM2.5)
          - identifier: MODE
            name: Particulate Type
            data_type: ENUM
            format: ["pm2_5"]
            value: "pm2_5"
