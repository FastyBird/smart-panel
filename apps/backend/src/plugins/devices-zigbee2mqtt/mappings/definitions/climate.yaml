# Zigbee2MQTT Climate Mappings
# Handles thermostats and HVAC devices

version: "1.0"

transformers:
  # HVAC mode normalization
  hvac_mode:
    type: map
    bidirectional:
      off: "off"
      heat: "heating"
      cool: "cooling"
      auto: "auto"
      fan_only: "fan_only"
      dry: "dry"
      emergency_heating: "emergency_heating"

  # HVAC running state (read only)
  hvac_running_state:
    type: map
    direction: read_only
    read:
      idle: "idle"
      heat: "heating"
      cool: "cooling"
      fan_only: "fan_only"

  # Preset mode mapping
  preset_mode:
    type: map
    bidirectional:
      none: "none"
      away: "away"
      boost: "boost"
      comfort: "comfort"
      eco: "eco"
      home: "home"
      sleep: "sleep"
      activity: "activity"

  # Fan mode mapping
  fan_mode:
    type: map
    bidirectional:
      off: "off"
      low: "low"
      medium: "medium"
      high: "high"
      on: "on"
      auto: "auto"
      smart: "smart"

mappings:
  # Zigbee thermostat/climate device
  - name: climate
    description: "Zigbee thermostat or HVAC controller"
    priority: 100
    match:
      expose_type: climate
    device_category: THERMOSTAT
    channels:
      - identifier: thermostat
        name: Thermostat
        category: THERMOSTAT
        features:
          # Current/local temperature (read only)
          - z2m_feature: local_temperature
            direction: read_only
            panel:
              identifier: TEMPERATURE
              name: Current Temperature
              data_type: FLOAT
              unit: "°C"
              settable: false

          # Heating setpoint
          - z2m_feature: occupied_heating_setpoint
            panel:
              identifier: HEATING_THRESHOLD_TEMPERATURE
              name: Heating Setpoint
              data_type: FLOAT
              unit: "°C"

          # Alternative heating setpoint name
          - z2m_feature: current_heating_setpoint
            panel:
              identifier: HEATING_THRESHOLD_TEMPERATURE
              name: Heating Setpoint
              data_type: FLOAT
              unit: "°C"

          # Cooling setpoint
          - z2m_feature: occupied_cooling_setpoint
            panel:
              identifier: COOLING_THRESHOLD_TEMPERATURE
              name: Cooling Setpoint
              data_type: FLOAT
              unit: "°C"

          # System mode (off, heat, cool, auto, etc.)
          - z2m_feature: system_mode
            panel:
              identifier: MODE
              name: System Mode
              data_type: STRING
            transformer: hvac_mode

          # Running state (what the system is currently doing)
          - z2m_feature: running_state
            direction: read_only
            panel:
              identifier: STATUS
              name: Running State
              data_type: STRING
              settable: false
            transformer: hvac_running_state

          # Preset mode (away, boost, comfort, eco, etc.)
          - z2m_feature: preset
            panel:
              identifier: PRESET
              name: Preset Mode
              data_type: STRING
            transformer: preset_mode

          # Fan mode
          - z2m_feature: fan_mode
            panel:
              identifier: FAN_MODE
              name: Fan Mode
              data_type: STRING
            transformer: fan_mode

          # Local temperature calibration (optional)
          - z2m_feature: local_temperature_calibration
            panel:
              identifier: TEMPERATURE_CALIBRATION
              name: Temperature Calibration
              data_type: FLOAT
              unit: "°C"

          # PI heating demand (read only, percentage)
          - z2m_feature: pi_heating_demand
            direction: read_only
            panel:
              identifier: HEATING_STATE
              name: Heating Demand
              data_type: UCHAR
              format: [0, 100]
              unit: "%"
              settable: false

          # Valve position (read only, percentage)
          - z2m_feature: valve_position
            direction: read_only
            panel:
              identifier: POSITION
              name: Valve Position
              data_type: UCHAR
              format: [0, 100]
              unit: "%"
              settable: false
